<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ¬ã‚·ãƒ¼ãƒˆå‰²ã‚Šå‹˜ã‚¢ãƒ—ãƒªï¼ˆæ‰‹å…¥åŠ›ç‰ˆï¼‰</title>
<style>
body { font-family: sans-serif; margin: 20px; }
input, button, textarea, select { width:100%; margin:5px 0; padding:8px; font-size:16px; }
textarea { height:150px; }
</style>
</head>
<body>

<h2>ğŸ‘¤ åå‰ç™»éŒ²</h2>
<input type="text" id="name1" placeholder="1äººç›®ã®åå‰">
<input type="text" id="name2" placeholder="2äººç›®ã®åå‰">
<button onclick="registerNames()">ç™»éŒ²</button>

<h2>ğŸ“ ãƒ¬ã‚·ãƒ¼ãƒˆå…¥åŠ›ï¼ˆæ‰‹å…¥åŠ›ï¼‰</h2>
<label>æ—¥ä»˜: <input type="date" id="dateInput"></label>
<label>ãŠåº—ã®åå‰: <input type="text" id="shopInput" placeholder="ã‚¹ãƒ¼ãƒ‘ãƒ¼åãªã©"></label>

<textarea id="receiptInput" placeholder="å•†å“å é‡‘é¡&#10;ä¾‹: ã‚¢ã‚¤ã‚¹ã‚³ãƒ¼ãƒ’ãƒ¼ 500"></textarea>

<h2>ğŸ’° å‰²ã‚Šå‹˜ãƒ«ãƒ¼ãƒ«</h2>
<label><input type="checkbox" id="onlyMe"> ã‚¢ã‚¤ã‚¹ã‚³ãƒ¼ãƒ’ãƒ¼ â†’ ç§ã ã‘</label>
<label><input type="checkbox" id="onlyA"> ã˜ã‚ƒãŒã„ã‚‚ â†’ Aã•ã‚“ã ã‘</label>
<label><input type="checkbox" id="split"> ãã‚Œä»¥å¤–ã¯å‰²ã‚Šå‹˜</label>

<button onclick="generateSummary()">ã¾ã¨ã‚ä½œæˆ</button>

<h2>ã¾ã¨ã‚</h2>
<textarea id="summaryOutput" readonly></textarea>

<script>
let person1 = "";
let person2 = "";

window.onload = function() {
  const saved1 = localStorage.getItem("person1");
  const saved2 = localStorage.getItem("person2");
  if (saved1 && saved2) {
    document.getElementById("name1").value = saved1;
    document.getElementById("name2").value = saved2;
    person1 = saved1;
    person2 = saved2;
  }
}

function registerNames() {
  const n1 = document.getElementById("name1").value.trim();
  const n2 = document.getElementById("name2").value.trim();
  if (!n1 || !n2) {
    alert("2äººã¨ã‚‚åå‰å…¥ã‚Œã¦ã­ï¼");
    return;
  }
  person1 = n1;
  person2 = n2;
  localStorage.setItem("person1", person1);
  localStorage.setItem("person2", person2);
  alert("åå‰ç™»éŒ²å®Œäº†âœ¨");
}

function generateSummary() {
  const date = document.getElementById("dateInput").value || "æœªå…¥åŠ›";
  const shop = document.getElementById("shopInput").value || "æœªå…¥åŠ›";
  const receiptText = document.getElementById("receiptInput").value;

  const lines = receiptText.split("\n");
  let summary = `æ—¥ä»˜: ${date}\nãŠåº—: ${shop}\n\n`;

  lines.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length < 2) return;
    let price = parts.pop().replace(/[^\d]/g,'');
    let item = parts.join(" ");
    if (!price) return;

    if (document.getElementById("onlyMe").checked && item.includes("ã‚¢ã‚¤ã‚¹ã‚³ãƒ¼ãƒ’ãƒ¼")) {
      summary += `${item} Â¥${price} â†’ ${person1}ã ã‘\n`;
    } else if (document.getElementById("onlyA").checked && item.includes("ã˜ã‚ƒãŒã„ã‚‚")) {
      summary += `${item} Â¥${price} â†’ ${person2}ã ã‘\n`;
    } else if (document.getElementById("split").checked) {
      summary += `${item} Â¥${price} â†’ å‰²ã‚Šå‹˜\n`;
    } else {
      summary += `${item} Â¥${price} â†’ æœªè¨­å®š\n`;
    }
  });

  document.getElementById("summaryOutput").value = summary;
}
</script>

</body>
</html>
